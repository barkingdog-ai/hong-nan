# Google Form 自訂串接指南

## 基本原理

Google Form 允許透過 GET 請求直接提交表單資料，無需使用者介面。每個表單欄位都有唯一的 `entry.xxx` 識別碼。

### 核心概念
- **Form URL**: 表單的 `formResponse` 端點
- **Entry ID**: 每個欄位的唯一識別碼（如 `entry.250977054`）
- **Callback**: jQuery 回調函數（用於 JSONP）
- **Timestamp**: 防止快取的時間戳參數

## 實際案例分析

### 成功案例（宏南專案）

```http
GET https://docs.google.com/forms/d/e/1FAIpQLSdeBKB69Kd_DSWIF6M2a15x0gVT71pG7pThcR5A6cdtwml2Ig/formResponse?callback=jQuery351043889636731970705_1753865543967&entry.250977054=9999&entry.57431109=999&entry.615449077=9999&entry.282796732_year=2025&entry.282796732_month=8&entry.282796732_day=8&entry.1692193185=10%EF%BC%9A30&entry.977853239=%E6%9C%8B%E5%8F%8B%E4%BB%8B%E7%B4%B9
```

### 失敗案例（原始版本）

```http
GET https://docs.google.com/forms/d/e/1FAIpQLSdeBKB69Kd_DSWIF6M2a15x0gVT71pG7pThcR5A6cdtwml2Ig/formResponse?callback=jQuery351043889636731970705_1753865543967&entry.250977054=054&entry.57431109=109&entry.615449077=077&entry.109010998=998&entry.977853239=239&entry.282796732_year=2029&entry.282796732_month=12&entry.282796732_day=12&_=1753865543968
```

### 關鍵差異分析

| 欄位 | 失敗版本 | 成功版本 | 問題原因 |
|------|----------|----------|----------|
| `entry.109010998` | `998` | **移除** | 可能是無效/不存在的欄位 |
| `entry.977853239` | `239` | `朋友介紹` | 選擇題需要正確的選項值 |
| `entry.1692193185` | **遺漏** | `10：30` | 可能是必填的時間欄位 |

## 常見問題與解決方案

### 1. 400 Bad Request 錯誤

**可能原因：**
- 必填欄位遺漏
- 選擇題/下拉選單使用錯誤的值
- 欄位 ID 不存在或拼寫錯誤
- 日期格式不正確

**解決方法：**
- 檢查所有必填欄位是否都有提供
- 確認選擇題使用正確的選項文字
- 驗證欄位 ID 的正確性

### 2. 日期欄位格式

**正確格式：**
```
entry.282796732_year=2025
entry.282796732_month=8  
entry.282796732_day=8
```

**注意事項：**
- 月份和日期不需要補零
- 年份使用完整的四位數
- 分別使用 `_year`, `_month`, `_day` 後綴

### 3. 選擇題欄位

**錯誤做法：**
```
entry.977853239=239  // 使用數字或代碼
```

**正確做法：**
```
entry.977853239=朋友介紹  // 使用實際的選項文字
```

### 4. URL 編碼

中文字元需要進行 URL 編碼：
- `朋友介紹` → `%E6%9C%8B%E5%8F%8B%E4%BB%8B%E7%B4%B9`
- `10：30` → `10%EF%BC%9A30`

## 調試流程

### 1. 段階式測試
1. **基本欄位測試**: 先測試文字欄位
2. **逐步增加**: 一次加入一個複雜欄位
3. **問題隔離**: 確定哪個欄位導致錯誤

### 2. 欄位驗證方法
- 使用瀏覽器開發者工具查看實際表單 HTML
- 檢查 `input` 標籤的 `name` 屬性
- 觀察表單正常提交時的網路請求

### 3. 調试 URL 範例

```http
### 測試 1: 僅基本欄位
GET .../formResponse?entry.250977054=test&entry.57431109=test

### 測試 2: 加入選擇題
GET .../formResponse?entry.250977054=test&entry.977853239=朋友介紹

### 測試 3: 加入日期
GET .../formResponse?entry.250977054=test&entry.282796732_year=2025
```

## 最佳實踐

### 1. 欄位命名規範
- 使用描述性的變數名對應 entry ID
- 建立欄位對照表方便維護

### 2. 錯誤處理
- 實作重試機制
- 記錄失敗的請求內容
- 提供使用者友好的錯誤訊息

### 3. 資料驗證
- 在送出前驗證必填欄位
- 確認選擇題的值在允許範圍內
- 驗證日期格式的正確性

## 參考資源

- [LetsWrite - 自訂 Google Form](https://www.letswrite.tw/custom-google-form/)
- Google Forms API 文件
- 專案實際測試檔案：`tmp.http`

## 更新日誌

- **2025-01-30**: 初始版本，記錄宏南專案的問題解決經驗
- 發現問題不在日期格式，而在欄位配置和數據驗證